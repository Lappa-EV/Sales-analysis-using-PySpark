# Анализ продаж розничного магазина с помощью PySpark

Этот проект анализирует данные о продажах розничного магазина с использованием PySpark для выполнения очистки данных, проверки, разведочного анализа данных (EDA) и разработки признаков. 
Набор данных `retail_store_sales.csv` содержит информацию о транзакциях в розничном магазине, включая продажи по восьми категориям товаров, в каждой категории содержится 25 товаров со статическими ценами. 
Набор данных содержит пропущенные значения, несогласованные данные и ошибки, которые необходимо исправить.

## Описание набора данных

Набор данных включает 11 столбцов:

![column.png](/column.png)

## Задачи

1.  **Загрузка и предварительная обработка данных**
    *   **1.1. Загрузка и вывод схемы:** 

    Загрузите файл [retail_store_sales.csv](/retail_store_sales.csv). Выведите первые 5 строк загруженного DataFrame и его схему (`df.printSchema()`).
    *   **1.2. Очистка названий столбцов:** Преобразуйте названия всех столбцов к нижнему регистру в формате snake_case. Выведите обновленную схему или названия столбцов, чтобы убедиться в изменениях.
    *   **1.3. Преобразование типов данных:** Приведите каждый столбец к соответствующему типу данных, преобразуя некорректные или пропущенные значения в `null` только в столбцах, где пропущенные данные допустимы (как указано в описаниях).
    
    <br>
    
2.  **Очистка и проверка данных**
    *   **2.1. Восстановление пропущенных товаров (`item`):**
        *   Создайте справочник товаров DataFrame с `Category`, `Item` и `Price Per Unit` из строк, где товары (*не* равны null).
        *   Для транзакций с отсутствующими названиями товаров, но существующей категорией и информацией о цене, попытайтесь определить название товара, объединив с DataFrame справочника товаров.
        *   Отобразите 20 строк, показывающих восстановленные значения товаров.
    *   **2.2. Восстановление `total_spent`:** Для всех транзакций с отсутствующими значениями `total_spent`, пересчитайте их как `quantity * price_per_unit`.
    *   **2.3. Заполнение пропущенных значений `quantity` и `price_per_unit`:**
        *   Для транзакций, где отсутствует `quantity`, но есть `total_spent` и `price_per_unit`, вычислите `quantity` и заполните пропущенное значение (преобразовав в целое число).
        *   Аналогично, если `price_per_unit` отсутствует, но доступны `total_spent` и `quantity`, вычислите и заполните пропущенный `price_per_unit` (округлив до двух десятичных знаков).
        *   Отобразите 20 строк, показывающих заполненные значения.
    *   **2.4. Удаление оставшихся строк с пропущенными значениями:** Удалите все строки с пропущенными значениями в столбцах `category`, `quantity`, `total_spent` и `price_per_unit`.

    <br>
3.  **Разведочный анализ данных**
    *   **3.1. Самые популярные категории товаров:** Рассчитайте общее количество проданных единиц товара для каждой категории. Определите топ-5 категорий по общему количеству проданных единиц.
    *   **3.2. Анализ средней транзакции:**
        *   Рассчитайте средний `total_spent` для каждого метода оплаты (округлено до двух десятичных знаков).
        *   Рассчитайте средний `total_spent` для каждого места совершения транзакции (округлено до двух десятичных знаков).
    
        <br>
4.  **Разработка признаков**
    *   **4.1. Временные признаки:** Добавьте два новых столбца на основе `transaction_date`:
        *   `day_of_week`: День недели.
        *   `transaction_month`: Месяц транзакции.
    *   **4.2. Продажи по дням недели:** Рассчитайте среднюю сумму продаж (`total_spent`) для каждого дня недели. Отобразите результаты, отсортированные по дням недели.
    *   **4.3. Продажи по месяцам:** Рассчитайте среднюю сумму продаж (`total_spent`) для каждого месяца. Отобразите результаты, отсортированные по месяцам.
    *   **4.4. Признаки клиента:** Рассчитайте пожизненную ценность клиента (CLV) для каждого клиента как общую сумму (`total_spent`), потраченную этим клиентом во всех транзакциях. Отобразите топ-10 клиентов по их CLV (`customer_id` и CLV).

## Использование

1.  Убедитесь, что у вас установлен PySpark.
2.  Загрузите набор данных [retail_store_sales.csv](/retail_store_sales.csv) и поместите его в правильное место.
3.  Обновите переменную `file_path` в коде, чтобы указать правильный путь к набору данных.
4.  Запустите код PySpark для выполнения задач анализа данных. Код выведет результаты в консоль. 

## Примечания

*   Этот проект использует PySpark для анализа данных.
*   Код предполагает, что набор данных находится в указанном `file_path`.
*   Пользовательская схема определена для обеспечения загрузки данных с правильными типами данных.
*   Подробные комментарии включены в код файла [Colab_PySpark.ipynb](/Colab_PySpark.ipynb), чтобы объяснить каждый шаг процесса анализа данных.

<br>
Выполнила: Катерина Лаппа
